# 第五步：添加数据库和配置环境变量

## ✅ 当前状态

- ✅ 后端服务已部署成功（显示 "Online"）
- ✅ 部署状态：Deployment successful

---

## 📋 接下来的步骤

### 步骤1：添加PostgreSQL数据库

1. **在Railway项目页面**，点击 **"+ Create"** 按钮（右上角）
   - 或者点击页面上的 **"+ New"** 按钮

2. **选择数据库**
   - 在下拉菜单中选择 **"Database"**
   - 然后选择 **"Add PostgreSQL"**

3. **等待数据库创建**
   - Railway会自动创建PostgreSQL数据库
   - 等待约1-2分钟
   - 创建成功后，会在Architecture视图中显示一个新的数据库服务

**⚠️ 重要**：数据库创建后，Railway会自动设置 `DATABASE_URL` 环境变量，不需要手动添加。

---

### 步骤2：配置后端服务环境变量

1. **点击 "thread-calculator" 服务卡片**

2. **点击 "Settings" 标签页**

3. **点击 "Variables" 标签页**

4. **添加环境变量**（点击 **"+ New Variable"**）：

   **变量1：PORT**
   - **Name**：`PORT`
   - **Value**：`3000`
   - 点击 **"Add"**

   **变量2：NODE_ENV**
   - **Name**：`NODE_ENV`
   - **Value**：`production`
   - 点击 **"Add"**

   **变量3：CORS_ORIGIN**
   - **Name**：`CORS_ORIGIN`
   - **Value**：`https://placeholder.vercel.app`
   - 点击 **"Add"**
   - **⚠️ 注意**：这个值后面部署完前端后需要修改为实际的前端URL

5. **检查DATABASE_URL**
   - 添加数据库后，`DATABASE_URL` 应该会自动出现在变量列表中
   - 如果还没有，等待数据库创建完成后再检查

---

### 步骤3：获取后端URL

1. **在 "thread-calculator" 服务页面**，点击 **"Settings"** 标签页

2. **找到 "Networking" 或 "Domains" 部分**

3. **生成域名**：
   - 找到 **"Generate Domain"** 按钮
   - 点击它
   - Railway会生成一个URL，例如：`https://thread-calculator-production.up.railway.app`

4. **⚠️ 重要**：**记下这个URL**！
   - 这是您的后端API地址
   - 后面部署前端时需要用到
   - 格式类似：`https://xxx.up.railway.app`

---

### 步骤4：检查服务配置

1. **在 "thread-calculator" 服务页面**，点击 **"Settings"** 标签页

2. **检查以下配置**：

   **Root Directory**：
   - 应该设置为：`server`
   - 如果没有，点击编辑，设置为 `server`

   **Build Command**：
   - 应该自动填充为：`npm install && npm run build`
   - 如果没有，手动设置为：`npm install && npm run build`

   **Start Command**：
   - 应该自动填充为：`npm start`
   - 如果没有，手动设置为：`npm start`

---

## ✅ 完成标志

- [ ] PostgreSQL数据库已添加
- [ ] 环境变量已设置（PORT, NODE_ENV, CORS_ORIGIN）
- [ ] DATABASE_URL已自动配置
- [ ] 后端服务配置正确（Root Directory: server）
- [ ] 已获取后端URL

---

## 🎯 下一步

完成后，我会指导您：
1. 运行数据库迁移
2. 在Vercel部署前端
3. 更新CORS配置
4. 测试访问

---

## ❓ 如果遇到问题

如果在操作过程中遇到问题，请告诉我：
1. 执行到哪一步了？
2. 具体的错误信息或截图
3. Railway页面显示什么？

我会帮您解决！

---

## 📝 现在请执行

**现在请按照以上步骤操作**：

1. 添加PostgreSQL数据库
2. 配置环境变量
3. 获取后端URL
4. 检查服务配置

完成后告诉我：
1. 数据库是否已添加？
2. 环境变量是否已设置？
3. 后端URL是什么？

我会继续指导下一步！

