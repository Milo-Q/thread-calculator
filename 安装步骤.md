# 缝纫线计算器 - 详细安装步骤

## 前置要求

在开始之前，请确保您的电脑上已经安装了：

1. **Node.js**（版本 >= 18.0.0）
   - 检查方法：打开终端（Terminal），输入 `node -v`
   - 如果没有安装，请访问 https://nodejs.org/ 下载安装
   - 安装Node.js后，npm（Node包管理器）会自动安装

2. **npm**（版本 >= 9.0.0）
   - 检查方法：打开终端，输入 `npm -v`
   - 通常安装Node.js后会自带npm

---

## 第一步：打开终端并进入项目目录

### Windows 用户：
1. 按 `Win + R` 键，输入 `cmd` 或 `powershell`，按回车
2. 使用 `cd` 命令进入项目目录，例如：
   ```bash
   cd C:\Users\你的用户名\cursor\用线计算器
   ```
   或者直接进入文件夹，在地址栏输入 `cmd` 按回车

### Mac/Linux 用户：
1. 打开终端（Terminal）
2. 使用 `cd` 命令进入项目目录，例如：
   ```bash
   cd ~/cursor/用线计算器
   ```
   或者直接拖拽文件夹到终端窗口

**验证是否在正确目录：**
输入 `ls` (Mac/Linux) 或 `dir` (Windows)，应该能看到 `client`、`server`、`package.json` 等文件夹和文件。

---

## 第二步：安装所有依赖

### 方法一：一键安装（推荐）

在项目根目录（`用线计算器` 文件夹）下，输入：

```bash
npm run install:all
```

这个命令会自动安装：
- 项目根目录的依赖
- 前端（client）的依赖
- 后端（server）的依赖

**等待时间：** 通常需要 2-5 分钟，取决于网络速度

**如果看到类似以下输出，说明安装成功：**
```
added 50 packages in 30s
```

### 方法二：手动分别安装（如果方法一失败）

如果方法一失败，可以手动分别安装：

```bash
# 1. 安装根目录依赖
npm install

# 2. 安装前端依赖
cd client
npm install
cd ..

# 3. 安装后端依赖
cd server
npm install
cd ..
```

---

## 第三步：初始化数据库

### 3.1 进入server目录

```bash
cd server
```

### 3.2 生成Prisma客户端

```bash
npm run prisma:generate
```

**等待时间：** 通常需要 10-30 秒

**成功标志：** 看到类似以下输出：
```
✔ Generated Prisma Client
```

### 3.3 创建数据库迁移

```bash
npm run prisma:migrate
```

**注意：** 第一次运行时会提示输入迁移名称，直接按回车使用默认名称即可。

**等待时间：** 通常需要 5-10 秒

**成功标志：** 
- 会创建一个 `prisma/migrations` 文件夹
- 会创建 `dev.db` 文件（SQLite数据库文件）
- 看到类似以下输出：
```
✔ Migration completed successfully
```

### 3.4 初始化初始数据（服装种类数据）

```bash
npm run init:data
```

**成功标志：** 看到类似以下输出：
```
开始初始化数据...
成功初始化 20 条服装种类数据
初始化完成
```

### 3.5 返回项目根目录

```bash
cd ..
```

---

## 第四步：启动应用

### 方法一：同时启动前后端（推荐）

在项目根目录下，输入：

```bash
npm run dev
```

这会同时启动：
- 后端服务（http://localhost:3000）
- 前端应用（http://localhost:5173）

**您会看到两个终端窗口的输出：**
- 一个显示后端服务启动信息
- 一个显示前端服务启动信息

**等待时间：** 通常需要 10-30 秒

**成功标志：**
- 后端：看到 `服务器运行在 http://localhost:3000`
- 前端：看到 `Local: http://localhost:5173`

### 方法二：分别启动（如果方法一有问题）

**打开第一个终端窗口 - 启动后端：**

```bash
cd server
npm run dev
```

**打开第二个终端窗口 - 启动前端：**

```bash
cd client
npm run dev
```

---

## 第五步：访问应用

启动成功后：

1. **打开浏览器**（推荐使用 Chrome、Edge、Firefox）
2. **访问前端地址：** http://localhost:5173
3. **您应该看到：**
   - 顶部导航栏（订单计算、服装种类管理、历史订单）
   - 主界面内容

**如果无法访问，请检查：**
- 终端中是否有错误信息
- 端口 5173 和 3000 是否被其他程序占用
- 防火墙是否阻止了访问

---

## 验证安装是否成功

### 1. 检查后端API是否正常

在浏览器中访问：http://localhost:3000/api/health

**应该看到：**
```json
{
  "status": "ok",
  "message": "缝纫线计算器后端服务运行中"
}
```

### 2. 检查前端是否正常

访问：http://localhost:5173

**应该看到：**
- 页面正常加载
- 没有错误提示
- 可以看到"缝纫线计算器"标题

### 3. 检查数据库是否初始化成功

```bash
cd server
npm run prisma:studio
```

这会打开 Prisma Studio，您可以在浏览器中查看数据库内容。

**应该看到：**
- GarmentType 表中有 20 条数据（服装种类）

---

## 常见问题解决

### 问题1：npm 命令不存在

**错误信息：** `'npm' 不是内部或外部命令`

**解决方法：**
- 确保已安装 Node.js
- 重新打开终端
- 检查环境变量 PATH 是否包含 Node.js 路径

### 问题2：端口被占用

**错误信息：** `Port 3000 is already in use` 或 `Port 5173 is already in use`

**解决方法：**
1. 找到占用端口的程序并关闭
2. 或者修改端口（需要修改配置文件）

**Windows 查看占用端口的程序：**
```bash
netstat -ano | findstr :3000
netstat -ano | findstr :5173
```

**Mac/Linux 查看占用端口的程序：**
```bash
lsof -i :3000
lsof -i :5173
```

### 问题3：Prisma 命令失败

**错误信息：** `prisma: command not found`

**解决方法：**
```bash
cd server
npm install -D prisma
npm run prisma:generate
```

### 问题4：数据库文件不存在

**错误信息：** `Cannot find database file`

**解决方法：**
```bash
cd server
npm run prisma:migrate
```

这会重新创建数据库文件。

### 问题5：依赖安装失败

**解决方法：**
1. 清除缓存：
   ```bash
   npm cache clean --force
   ```
2. 删除 node_modules 文件夹和 package-lock.json：
   ```bash
   # Windows
   rmdir /s node_modules
   del package-lock.json
   
   # Mac/Linux
   rm -rf node_modules
   rm package-lock.json
   ```
3. 重新安装：
   ```bash
   npm install
   ```

### 问题6：CORS 错误

**错误信息：** `Access to XMLHttpRequest has been blocked by CORS policy`

**解决方法：**
- 确保后端服务正在运行（http://localhost:3000）
- 确保前端服务正在运行（http://localhost:5173）
- 检查 `server/src/index.ts` 中的 CORS 配置

---

## 快速命令参考

```bash
# 安装依赖
npm run install:all

# 初始化数据库（在server目录下）
cd server
npm run prisma:generate
npm run prisma:migrate
npm run init:data
cd ..

# 启动应用
npm run dev

# 停止应用
按 Ctrl + C（在终端中）
```

---

## 下一步

安装完成后，您可以：

1. **查看快速开始指南：** 阅读 `QUICKSTART.md` 了解如何使用
2. **测试功能：** 按照测试用例创建一个订单并计算
3. **查看文档：** 阅读 `PRD.md` 了解详细功能说明

---

## 需要帮助？

如果遇到任何问题，请：
1. 检查终端中的错误信息
2. 查看上面的"常见问题解决"部分
3. 告诉我具体的错误信息，我会帮您解决

