# 测试后端并运行数据库迁移

## ✅ 后端URL已获取

**后端URL**：`https://thread-calculator-production.up.railway.app`

---

## 🧪 步骤1：测试后端API

首先测试后端是否正常工作：

### 测试健康检查端点

在浏览器中打开：
```
https://thread-calculator-production.up.railway.app/api/health
```

或者测试获取订单列表：
```
https://thread-calculator-production.up.railway.app/api/orders
```

**预期结果**：
- 如果返回JSON数据（即使是空数组 `[]`），说明后端正常 ✅
- 如果返回404或错误，可能需要检查路由配置

---

## 🗄️ 步骤2：运行数据库迁移

我们需要运行Prisma迁移来创建数据库表结构。

### 方法A：使用Railway的Shell（推荐）

1. **在Railway中**，点击 **"thread-calculator"** 服务
2. **点击 "Deploy Logs" 标签页**
3. **查看右上角是否有 "..." 菜单**
4. **点击 "..." 菜单**，查找：
   - "Open Shell"
   - "Run Command"
   - "Terminal"
   等选项
5. **在打开的终端中执行**：
   ```bash
   cd server
   npm run prisma:migrate
   ```

### 方法B：修改启动脚本自动运行迁移

如果找不到Shell选项，我们可以修改启动脚本：

1. **修改 `server/package.json`**：
   ```json
   {
     "scripts": {
       "start": "npm run prisma:migrate && node dist/index.js"
     }
   }
   ```

2. **提交并推送更改**：
   ```bash
   git add server/package.json
   git commit -m "添加自动迁移到启动脚本"
   git push
   ```

3. **Railway会自动重新部署**，迁移会在启动时自动运行

---

## 🔍 步骤3：验证迁移成功

迁移成功后，可以：

1. **测试API端点**，看是否能正常返回数据
2. **检查Railway日志**，确认没有数据库相关错误

---

## ✅ 完成标志

- [ ] 后端URL可以访问（返回JSON或正常响应）
- [ ] 数据库迁移已运行（或已配置自动运行）
- [ ] 没有数据库连接错误

---

## 🎯 下一步

完成迁移后，我们将：
1. 在Vercel部署前端
2. 配置前端连接到后端URL
3. 测试完整应用

---

## ❓ 现在请执行

1. **测试后端URL**：
   - 在浏览器中打开：`https://thread-calculator-production.up.railway.app/api/orders`
   - 告诉我返回了什么（JSON数据、错误信息等）

2. **运行数据库迁移**：
   - 尝试在Railway的Deploy Logs中找到"Open Shell"或类似选项
   - 如果找不到，告诉我，我会帮您修改启动脚本

完成后告诉我结果，我们继续下一步！

