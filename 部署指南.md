# 部署指南

## 当前状态检查

### ✅ 已完成的功能
1. **订单计算**：创建订单、计算线费、采购数量等
2. **订单管理**：查看、编辑、删除订单，按服装种类折叠显示
3. **统计数据**：按服装种类和属性统计平均线费和测量数据
4. **服装种类管理**：CRUD操作，按种类折叠显示
5. **数据导出**：订单详情导出、订单列表导出
6. **颜色管理**：在主界面直接管理颜色

### 📋 代码检查结果
- ✅ 后端编译通过
- ✅ 前端编译通过（有一些TypeScript类型警告，但不影响运行）
- ✅ 主要功能代码完整
- ✅ 数据库迁移文件已准备

## 下一步操作步骤

### 阶段一：代码整理和备份（推荐优先完成）

#### 1. 初始化Git仓库（如果还没有）
```bash
cd "/Users/Zhuanz/cursor/用线计算器"
git init
git add .
git commit -m "初始提交：完整功能的缝纫线计算器"
```

#### 2. 创建 .gitignore（如果还没有）
确保以下内容在 `.gitignore` 中：
```
node_modules/
dist/
build/
.env
.env.local
*.log
.DS_Store
server/prisma/dev.db
server/prisma/dev.db-journal
```

### 阶段二：本地测试和验证

#### 1. 功能测试清单
请在本地完整测试以下功能：

- [ ] 创建新订单并计算
- [ ] 查看订单详情（包含所有计算结果）
- [ ] 编辑订单
- [ ] 删除订单
- [ ] 导出订单详情Excel
- [ ] 导出订单列表Excel
- [ ] 统计页面查看数据
- [ ] 服装种类管理（增删改查）
- [ ] 颜色管理（增删改查）

#### 2. 数据备份
如果已有测试数据，建议备份数据库：
```bash
cd "/Users/Zhuanz/cursor/用线计算器/server"
cp prisma/dev.db prisma/dev.db.backup
```

### 阶段三：准备云端部署

#### 选项A：使用云数据库（推荐）
根据PRD要求，数据需要云端存储。建议使用以下方案：

**推荐的云数据库服务：**
1. **阿里云RDS MySQL**（国内访问快）
2. **腾讯云MySQL**（国内访问快）
3. **Supabase PostgreSQL**（免费额度，国外服务）
4. **Railway PostgreSQL**（免费额度，国外服务）

#### 选项B：使用云服务器部署（完整方案）
需要：
- 云服务器（如阿里云ECS、腾讯云CVM）
- 云数据库（MySQL/PostgreSQL）
- 域名（可选）

### 阶段四：部署步骤（以阿里云RDS MySQL为例）

#### 1. 准备云数据库
1. 在阿里云控制台创建RDS MySQL实例
2. 获取连接信息：
   - 主机地址（Host）
   - 端口（Port，默认3306）
   - 数据库名（Database）
   - 用户名（Username）
   - 密码（Password）

#### 2. 修改数据库配置
```bash
# 编辑 server/.env 文件
DATABASE_URL="mysql://用户名:密码@主机地址:端口/数据库名"
PORT=3000
NODE_ENV=production
CORS_ORIGIN=http://your-domain.com
```

#### 3. 更新Prisma Schema（如果需要）
```bash
cd server
# 如果使用MySQL，确保schema.prisma中datasource使用mysql
```

#### 4. 运行数据库迁移
```bash
cd server
npm install
npm run prisma:generate
npm run prisma:migrate
npm run init:data  # 如果需要初始化数据
```

#### 5. 构建后端
```bash
cd server
npm run build
```

#### 6. 配置前端环境变量
创建 `client/.env.production`：
```
VITE_API_BASE_URL=http://your-backend-domain.com/api
```

#### 7. 构建前端
```bash
cd client
npm install
npm run build
```

#### 8. 部署到云服务器
- 上传 `server/dist` 和 `server/package.json` 到服务器
- 上传 `client/dist` 到服务器或CDN
- 在服务器上安装Node.js和PM2
- 使用PM2启动后端服务

### 阶段五：使用简化部署方案（推荐新手）

如果觉得上述步骤复杂，可以使用以下简化方案：

#### 方案1：使用Vercel/Netlify（前端）+ Railway/Render（后端）
- **前端**：部署到Vercel或Netlify（免费）
- **后端**：部署到Railway或Render（免费额度）
- **数据库**：使用Railway提供的PostgreSQL或Supabase

#### 方案2：使用Docker（一键部署）
我可以为您创建Docker配置文件，实现一键部署。

## 推荐的下一步行动

### 立即可以做的：
1. ✅ **功能测试**：完整测试所有功能，确保没有问题
2. ✅ **代码备份**：初始化Git仓库，提交代码
3. ✅ **创建部署配置文件**：我可以帮您创建Docker配置或部署脚本

### 需要您决定的：
1. **选择云服务提供商**：
   - 国内：阿里云、腾讯云、华为云
   - 国外：Railway、Render、Vercel、Supabase

2. **部署方式**：
   - 简化方案（推荐）：使用现成的PaaS平台
   - 完整方案：自己管理云服务器

3. **预算考虑**：
   - 免费方案：Railway、Render、Supabase（有免费额度）
   - 付费方案：阿里云、腾讯云（需要付费，但更稳定）

## 需要我帮您做什么？

请告诉我：
1. 您更倾向于哪种部署方式？（简化方案 vs 完整方案）
2. 您的预算情况？（免费 vs 付费）
3. 是否需要我帮您创建部署配置文件？
4. 是否有其他特殊需求？

