# 完整操作指南 - 从零开始部署

本指南会一步步教您完成所有操作。

---

## 📋 第一步：打开终端

### Mac用户：
1. 按 `Command + 空格键`
2. 输入 `Terminal` 或 `终端`
3. 按回车键

### Windows用户：
1. 按 `Win + R`
2. 输入 `cmd`
3. 按回车键

---

## 📋 第二步：进入项目目录

在终端中输入以下命令（复制粘贴即可）：

```bash
cd "/Users/Zhuanz/cursor/用线计算器"
```

按回车执行。

**预期结果**：终端提示符会显示当前路径。

**如果出现错误**：可能是路径不对，告诉我，我帮您找到正确的路径。

---

## 📋 第三步：检查Git状态

在终端中输入：

```bash
git status
```

按回车执行。

**预期结果**：应该显示 `On branch main` 或 `nothing to commit, working tree clean`

**如果显示错误**：告诉我具体的错误信息。

---

## 📋 第四步：检查是否已连接GitHub

在终端中输入：

```bash
git remote -v
```

按回车执行。

**预期结果1**：什么都不显示（说明还没连接GitHub，需要执行第五步）

**预期结果2**：显示GitHub地址（说明已经连接，可以直接跳到第六步）

---

## 📋 第五步：创建GitHub仓库并连接

### 5.1 在浏览器中创建GitHub仓库

1. **打开浏览器**，访问：https://github.com/new

2. **如果没有GitHub账号**：
   - 先注册账号（免费）
   - 使用邮箱注册即可

3. **创建新仓库**：
   - **Repository name**（仓库名称）：输入 `thread-calculator`（或其他您喜欢的名称）
   - **Description**（描述）：可选，输入"缝纫线计算器"
   - **Public / Private**：选择 Public（公开，免费）或 Private（私有，免费）
   - **⚠️ 重要**：不要勾选以下选项：
     - ❌ Add a README file
     - ❌ Add .gitignore
     - ❌ Choose a license
   - 点击绿色的 **"Create repository"** 按钮

4. **创建成功后**，GitHub会显示一个页面，页面上有类似的命令，**但先不要执行**，继续看下面的步骤。

### 5.2 获取您的GitHub用户名

在GitHub页面的右上角，点击您的头像，可以看到您的用户名（username）。

**记下您的用户名**，比如 `zhuanz` 或 `your-username`。

### 5.3 在终端中连接GitHub仓库

回到终端，执行以下命令（**请将 `YOUR_USERNAME` 和 `YOUR_REPO` 替换为您的实际信息**）：

```bash
# 示例：如果您的用户名是 zhuanz，仓库名是 thread-calculator
# 则命令是：git remote add origin https://github.com/zhuanz/thread-calculator.git

git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
```

**替换说明**：
- `YOUR_USERNAME` → 您的GitHub用户名
- `YOUR_REPO` → 您的仓库名称（如 thread-calculator）

**示例**：
```bash
# 假设用户名是 zhuanz，仓库名是 thread-calculator
git remote add origin https://github.com/zhuanz/thread-calculator.git
```

按回车执行。

**预期结果**：没有错误信息，命令执行成功。

**如果出现错误**：
- `fatal: remote origin already exists` → 说明已经连接过，可以跳过这一步
- 其他错误 → 告诉我具体的错误信息

### 5.4 推送代码到GitHub

在终端中执行：

```bash
git branch -M main
git push -u origin main
```

按回车执行。

**注意**：
- 第一次推送可能需要输入GitHub用户名和密码（或Personal Access Token）
- 如果要求输入密码，但密码输入不显示，这是正常的（安全机制），直接输入后按回车即可

**预期结果**：
- 显示上传进度
- 最后显示 `Everything up-to-date` 或 `* [new branch] main -> main`

**如果出现错误**：
- 需要认证 → 可能需要配置Git认证（告诉我，我会帮您）
- 其他错误 → 告诉我具体的错误信息

---

## 📋 第六步：注册部署平台账号

### 6.1 注册Vercel账号（前端部署）

1. 访问：https://vercel.com
2. 点击右上角 **"Sign Up"** 或 **"登录"**
3. 选择 **"Continue with GitHub"**（推荐，使用GitHub账号登录）
4. 授权Vercel访问GitHub账号
5. 完成注册

### 6.2 注册Railway账号（后端+数据库部署）

1. 访问：https://railway.app
2. 点击右上角 **"Login"** 或 **"Get Started"**
3. 选择 **"Login with GitHub"**（推荐）
4. 授权Railway访问GitHub账号
5. 完成注册

**注意**：Railway会要求验证邮箱，请按照提示操作。

---

## 📋 第七步：在Railway部署后端和数据库

### 7.1 创建新项目

1. 登录Railway后，点击 **"+ New Project"**
2. 选择 **"Deploy from GitHub repo"**
3. 如果第一次使用，可能需要授权Railway访问GitHub
4. 在仓库列表中找到您的 `thread-calculator` 仓库
5. 点击仓库名称

### 7.2 添加PostgreSQL数据库

1. Railway会自动创建一个服务
2. 点击项目页面下方的 **"+ New"** 按钮
3. 选择 **"Database"** → **"Add PostgreSQL"**
4. 等待数据库创建完成（约1-2分钟）

### 7.3 配置后端服务

1. 在Railway项目页面，找到您的后端服务（通常是第一个服务）
2. 点击服务名称进入服务详情页
3. 点击 **"Settings"** 标签页

**配置以下信息**：

- **Root Directory**：设置为 `server`
- **Build Command**：设置为 `npm install && npm run build`
- **Start Command**：设置为 `npm start`

如果Railway自动检测到了，可能不需要修改。

### 7.4 配置环境变量

1. 在服务详情页，点击 **"Variables"** 标签页
2. 点击 **"+ New Variable"** 添加以下环境变量：

**需要添加的变量**：

```
PORT=3000
NODE_ENV=production
CORS_ORIGIN=https://your-frontend.vercel.app
```

**⚠️ 重要说明**：
- `DATABASE_URL` **不需要手动添加**，Railway会自动提供
- `CORS_ORIGIN` 暂时填 `https://placeholder.vercel.app`（后面部署完前端后再修改）

3. 点击 **"Add"** 保存每个变量

### 7.5 等待部署完成

1. 点击 **"Deployments"** 标签页
2. 等待部署完成（约3-5分钟）
3. 部署成功后，点击 **"Settings"** → **"Generate Domain"** 生成一个URL
4. **记下这个URL**，例如：`https://thread-calculator-production.up.railway.app`

这就是您的后端URL！

---

## 📋 第八步：运行数据库迁移

### 8.1 安装Railway CLI（可选，推荐使用网页方式）

**方式一：使用Railway网页界面（推荐，更简单）**

1. 在Railway项目页面，找到PostgreSQL数据库服务
2. 点击数据库服务
3. 在 **"Connect"** 标签页，找到 **"Connection URL"**
4. 点击复制按钮，复制数据库URL（格式类似：`postgresql://postgres:xxx@xxx.railway.app:5432/railway`）
5. **⚠️ 暂时保存这个URL，下一步需要用到**

**方式二：使用Railway CLI（命令行方式）**

如果熟悉命令行，可以安装Railway CLI：

```bash
# 安装Railway CLI
npm i -g @railway/cli

# 登录
railway login

# 连接到项目
cd "/Users/Zhuanz/cursor/用线计算器/server"
railway link

# 运行迁移
railway run npx prisma migrate deploy
```

### 8.2 在本地运行迁移（使用方式一的数据库URL）

1. 在终端中执行：

```bash
cd "/Users/Zhuanz/cursor/用线计算器/server"
```

2. 执行迁移命令（**将 YOUR_DATABASE_URL 替换为您复制的数据库URL**）：

```bash
DATABASE_URL="YOUR_DATABASE_URL" npx prisma migrate deploy
```

**示例**：
```bash
DATABASE_URL="postgresql://postgres:xxx@containers-us-west-xxx.railway.app:5432/railway" npx prisma migrate deploy
```

3. 按回车执行

**预期结果**：显示迁移成功的信息

**如果出现错误**：
- 数据库URL格式不对 → 检查是否完整复制了URL
- 连接失败 → 检查网络，或稍后重试

---

## 📋 第九步：在Vercel部署前端

### 9.1 导入项目

1. 登录Vercel后，点击 **"Add New..."** → **"Project"**
2. 在仓库列表中找到您的 `thread-calculator` 仓库
3. 点击 **"Import"**

### 9.2 配置项目

在配置页面，设置以下内容：

- **Framework Preset**：选择 **"Vite"**（如果没自动检测到）
- **Root Directory**：点击 **"Edit"**，设置为 `client`
- **Build Command**：`npm run build`（应该自动填充）
- **Output Directory**：`dist`（应该自动填充）
- **Install Command**：`npm install`（应该自动填充）

### 9.3 配置环境变量

在 **"Environment Variables"** 部分：

1. 点击 **"+ Add"**
2. 添加以下变量：
   - **Name**：`VITE_API_BASE_URL`
   - **Value**：`https://YOUR_BACKEND_URL.railway.app/api`
   
   **⚠️ 将 YOUR_BACKEND_URL 替换为您在第七步记下的后端URL**
   
   **示例**：
   ```
   VITE_API_BASE_URL=https://thread-calculator-production.up.railway.app/api
   ```
   
   注意：URL末尾不要加斜杠 `/`

3. 点击 **"Add"** 保存

### 9.4 部署

1. 点击页面底部的 **"Deploy"** 按钮
2. 等待部署完成（约2-3分钟）
3. 部署成功后，Vercel会显示一个URL，例如：`https://thread-calculator.vercel.app`
4. **记下这个URL**，这就是您的前端URL！

---

## 📋 第十步：更新后端CORS配置

### 10.1 回到Railway

1. 在Railway项目页面，找到后端服务
2. 点击服务 → **"Variables"** 标签页
3. 找到 `CORS_ORIGIN` 变量
4. 点击变量右侧的编辑按钮（铅笔图标）
5. 将值修改为您在第九步记下的前端URL：
   ```
   https://thread-calculator.vercel.app
   ```
   **注意**：URL末尾不要加斜杠 `/`
6. 保存

### 10.2 重新部署后端

1. 在Railway服务页面，点击 **"Deployments"** 标签页
2. 点击最新的部署右侧的 **"..."** 菜单
3. 选择 **"Redeploy"**
4. 等待重新部署完成（约2-3分钟）

---

## 📋 第十一步：测试访问

### 11.1 打开前端网站

在浏览器中打开您在第九步记下的前端URL，例如：
```
https://thread-calculator.vercel.app
```

### 11.2 测试功能

1. **测试页面加载**：页面应该正常显示
2. **测试创建订单**：尝试创建一个订单
3. **测试计算功能**：输入数据并计算
4. **测试其他功能**：查看订单、统计数据等

### 11.3 如果遇到问题

**如果页面无法加载**：
- 检查URL是否正确
- 检查浏览器控制台是否有错误（按F12查看）

**如果功能不工作**：
- 检查浏览器控制台的错误信息
- 确认环境变量配置正确
- 确认后端服务正在运行

---

## ✅ 完成！

恭喜！您的应用已经成功部署到云端了！

现在您可以在任何地方通过前端URL访问应用，数据会存储在云端数据库中。

---

## 📝 记录重要信息

建议您记录以下信息：

- **前端URL**：`https://xxx.vercel.app`
- **后端URL**：`https://xxx.railway.app`
- **GitHub仓库**：`https://github.com/xxx/thread-calculator`

---

## 🔄 后续更新代码

如果以后修改了代码，需要更新到云端：

```bash
# 1. 进入项目目录
cd "/Users/Zhuanz/cursor/用线计算器"

# 2. 提交更改
git add .
git commit -m "描述您的更改"

# 3. 推送到GitHub
git push

# 4. Railway和Vercel会自动重新部署（通常几分钟内完成）
```

---

## ❓ 需要帮助？

如果在任何步骤遇到问题，请告诉我：
1. 您执行到哪一步了
2. 具体的错误信息
3. 终端显示的完整错误

我会帮您解决问题！

