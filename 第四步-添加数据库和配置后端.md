# 第四步：添加数据库和配置后端

## ✅ 已完成

- ✅ Railway项目已创建
- ✅ 仓库已连接

---

## 📋 接下来的步骤

### 步骤1：添加PostgreSQL数据库

1. **在Railway项目页面**，点击 **"+ New"** 按钮
   - 通常在页面下方或右上角

2. **选择数据库**
   - 在下拉菜单中选择 **"Database"**
   - 然后选择 **"Add PostgreSQL"**

3. **等待数据库创建**
   - Railway会自动创建PostgreSQL数据库
   - 等待约1-2分钟，直到状态显示为 "Deployed" 或 "Active"

**⚠️ 重要**：数据库创建后，Railway会自动设置 `DATABASE_URL` 环境变量，不需要手动添加。

---

### 步骤2：检查后端服务配置

Railway应该已经自动检测到您的代码并创建了一个服务。

1. **找到后端服务**
   - 在项目页面，应该能看到一个服务（通常显示为您的仓库名或 "thread-calculator"）
   - 点击这个服务进入详情页

2. **检查服务设置**
   - 点击 **"Settings"** 标签页
   - 检查以下配置：

   **Root Directory**：
   - 应该设置为：`server`
   - 如果没有，点击编辑，设置为 `server`

   **Build Command**：
   - 应该自动填充为：`npm install && npm run build`
   - 如果没有，手动设置为：`npm install && npm run build`

   **Start Command**：
   - 应该自动填充为：`npm start`
   - 如果没有，手动设置为：`npm start`

---

### 步骤3：配置环境变量

1. **在后端服务页面**，点击 **"Variables"** 标签页

2. **添加环境变量**（点击 **"+ New Variable"**）：

   **变量1：PORT**
   - **Name**：`PORT`
   - **Value**：`3000`
   - 点击 **"Add"**

   **变量2：NODE_ENV**
   - **Name**：`NODE_ENV`
   - **Value**：`production`
   - 点击 **"Add"**

   **变量3：CORS_ORIGIN**
   - **Name**：`CORS_ORIGIN`
   - **Value**：`https://placeholder.vercel.app`
   - 点击 **"Add"**
   - **⚠️ 注意**：这个值后面部署完前端后需要修改为实际的前端URL

3. **DATABASE_URL（重要）**：
   - **⚠️ 不需要手动添加！**
   - Railway会自动从PostgreSQL数据库服务中获取
   - 会自动注入到后端服务中
   - 您可以在Variables列表中看到它（通常显示为引用，如 `${{Postgres.DATABASE_URL}}`）

---

### 步骤4：等待部署完成

1. **查看部署状态**
   - 点击 **"Deployments"** 标签页
   - 等待部署完成（通常3-5分钟）
   - 部署过程中，您可以看到构建日志
   - 部署成功后，状态会显示为 "Active" 或 "Deployed"

2. **检查部署日志**
   - 如果部署失败，点击部署记录查看日志
   - 告诉我错误信息，我会帮您解决

---

### 步骤5：获取后端URL

1. **部署完成后**，点击 **"Settings"** 标签页

2. **生成域名**
   - 找到 **"Generate Domain"** 按钮
   - 点击它
   - Railway会生成一个URL，例如：`https://thread-calculator-production.up.railway.app`

3. **⚠️ 重要**：**记下这个URL**！
   - 这是您的后端API地址
   - 后面部署前端时需要用到
   - 格式类似：`https://xxx.up.railway.app`

---

## ✅ 完成标志

- [ ] PostgreSQL数据库已添加
- [ ] 后端服务配置正确（Root Directory: server）
- [ ] 环境变量已设置（PORT, NODE_ENV, CORS_ORIGIN）
- [ ] 后端服务已部署成功
- [ ] 已获取后端URL

---

## 🎯 下一步

部署完成后，我会指导您：
1. 运行数据库迁移
2. 在Vercel部署前端
3. 更新CORS配置
4. 测试访问

---

## ❓ 如果遇到问题

如果在部署过程中遇到问题，请告诉我：
1. 执行到哪一步了？
2. 具体的错误信息或截图
3. 部署日志显示什么？

我会帮您解决！

---

## 📝 现在请执行

**现在请按照以上步骤操作**：

1. 添加PostgreSQL数据库
2. 检查后端服务配置
3. 设置环境变量
4. 等待部署完成
5. 获取后端URL

完成后告诉我：
1. 数据库是否已添加？
2. 后端是否部署成功？
3. 后端URL是什么？

我会继续指导下一步！

