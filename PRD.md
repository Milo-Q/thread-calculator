# 缝纫线计算器 PRD（产品需求文档）

## 1. 项目概述

### 1.1 项目背景
服装生产过程中，需要根据订单信息计算所需缝纫线的数量和金额，以便进行采购和成本核算。

### 1.2 项目目标
开发一个缝纫线计算器，能够根据订单信息自动计算：
- 单件用线量
- 总需线数量
- 采购金额
- 线费（单件线费）
- 采购数量明细

### 1.3 目标用户
服装生产企业、采购人员、成本核算人员

### 1.4 技术架构

#### 1.4.1 应用类型
- **Web应用**: 基于现代Web技术栈开发，支持多浏览器访问
- **响应式设计**: 支持PC端和移动端访问
- **无需安装**: 直接通过浏览器访问，无需下载安装

#### 1.4.2 数据存储方案
- **存储方式**: **云端存储**（推荐）或**本地存储**（可选）
  
**方案一：云端存储（推荐）**
- **优势**:
  - ✅ 数据跨设备同步，在任何电脑上都能查询和修改
  - ✅ 数据安全，不会因电脑故障丢失
  - ✅ 多用户协作，团队成员可以共享数据
  - ✅ 自动备份，减少数据丢失风险
- **实现方式**:
  - 后端API服务（Node.js/Python等）
  - 云数据库（如MySQL、PostgreSQL、MongoDB等）
  - 云服务器托管（如阿里云、腾讯云、AWS等）
  - 用户认证（可选，根据需求决定是否需要登录）

**方案二：本地存储**
- **优势**:
  - ✅ 数据完全本地化，隐私性强
  - ✅ 无需服务器成本
  - ✅ 离线可用，不依赖网络
- **劣势**:
  - ❌ 数据无法跨设备同步
  - ❌ 数据丢失风险（电脑故障、重装系统等）
  - ❌ 无法多用户协作
- **实现方式**:
  - 浏览器LocalStorage/IndexedDB（仅限单设备）
  - 本地文件存储（导出为JSON/CSV）

**方案三：混合存储（推荐）**
- **实现方式**:
  - 默认使用云端存储
  - 支持数据导出到本地（Excel/JSON）
  - 支持从本地文件导入数据
  - 离线模式下使用本地缓存，联网后自动同步

**推荐方案**: **云端存储（方案一）**，确保数据可以在任何电脑上查询和修改。

#### 1.4.3 用户权限管理
- **不需要用户登录和权限管理**（已确认）
- 系统为单机或多用户共享使用，不区分用户角色
- 所有数据对所有用户可见和可编辑

---

## 2. 功能需求

### 2.1 订单信息管理

#### 2.1.1 服装种类
- **类型**: 单选项
- **选项**: 冲锋衣、短裤、长裤、夹克、短款棉衣、长款棉衣、棉马甲、皮肤衣、马甲、工作服
- **要求**: 
  - **需要独立的管理界面**进行增删改查操作
  - 支持后期增加和修改
  - 主界面中通过下拉选择使用已配置的服装种类
- **管理界面功能**:
  - 添加服装种类（包含对应的属性和备注）
  - 编辑已有服装种类、属性、备注
  - 删除服装种类
  - 查看所有服装种类配置
- **数据存储**: 服装种类数据库

#### 2.1.2 属性
- **类型**: 单选项
- **选项**: 挂里、不挂里、简单、复杂、珩线多、珩线少
- **要求**: 
  - 根据"服装种类数据库"内容，当选择对应"服装种类"时自动匹配"属性"选项
- **数据存储**: 服装种类数据库

#### 2.1.3 颜色
- **类型**: 单选项（可在主界面直接管理）
- **要求**: 
  - 选项内容可以增加、修改、删除
  - **在主界面直接操作**（不需要单独的后台管理页面）
  - 新增颜色时，直接输入颜色名称
  - 颜色选项同步到后续计算和订单详情选择
- **界面形式**: 
  - 主界面提供"添加颜色"、"编辑颜色"、"删除颜色"功能
  - 颜色选择器支持搜索和筛选
- **数据存储**: 颜色数据库

#### 2.1.4 备注
- **类型**: 自动生成（只读）
- **要求**: 
  - 当选择对应"属性"后自动匹配对应"备注"内容
- **数据来源**: 服装种类数据库

### 2.2 原料信息管理

#### 2.2.1 线种类配置
- **类型**: 可配置多个线种类信息
- **选项**: 平车线、丝光线（支持扩展其他线种类）
- **要求**: 
  - 至少需要配置一种线种类
  - 可以同时配置多个线种类（如：同时配置平车线和丝光线）
  - 每种线种类需要独立配置对应的一轴线长和线单价
- **界面形式**: 
  - 支持添加/删除线种类配置项
  - 每个配置项包含：线种类名称、一轴线长、线单价

#### 2.2.2 一轴线长
- **类型**: 数字（单位：米）
- **要求**: 每个线种类配置项必填

#### 2.2.3 线单价
- **类型**: 数字（单位：元/轴）
- **要求**: 每个线种类配置项必填

**配置示例**:
- 线种类1: 平车线 - 一轴线长2700米 - 线单价2.2元
- 线种类2: 丝光线 - 一轴线长5000米 - 线单价4元

### 2.3 订单详情

#### 2.3.1 颜色
- **类型**: 单选项（可从订单信息中的颜色选项选择）
- **数据来源**: 订单信息中的颜色选项（颜色数据库）
- **要求**: 
  - 一个订单可以包含多个颜色
  - 每个颜色可以有不同的数量
  - 支持添加多条订单详情记录

#### 2.3.2 数量
- **类型**: 数字（单位：件）
- **要求**: 必填项，大于0

**界面形式**:
- 支持添加/删除订单详情行
- 每行包含：颜色选择器、数量输入框
- 可以添加多条记录，每条记录对应一种颜色和数量
- 同一订单可以包含相同的颜色（累加数量）或不同颜色

**示例**:
- 订单详情1: 红色 - 100件
- 订单详情2: 蓝色 - 200件
- 订单详情3: 黑色 - 400件
- 订单详情4: 绿色 - 100件

### 2.4 测量数据

#### 2.4.1 工艺类型
支持以下6种工艺，每种工艺对应一个测量数据输入：
- **平车** (Flat Stitch)
- **三线** (Three-thread)
- **四线** (Four-thread)
- **五线** (Five-thread)
- **坎车** (Overlock)
- **三针五线** (Three-needle Five-thread)

#### 2.4.2 测量数据
- **类型**: 数字（单位：米）
- **要求**: 
  - **各工艺独立输入**，每个工艺有独立的输入框
  - 可选项（可以为空）
  - 没有数据的工艺不需要输入
  - 当某个工艺的测量数据为空时，该工艺不参与后续计算
  - 不同工艺的测量数据可以不同
- **界面形式**:
  - 每个工艺对应一个独立的数字输入框
  - 空的输入框表示该工艺不参与计算

---

## 3. 核算数据计算

### 3.1 单件用量

#### 3.1.1 计算公式（已确认）
不同工艺的单件用量计算公式（严格按照以下公式计算）：

- **平车**: `测量数据 × 3 + 测量数据 × 3 × 0.2` = `测量数据 × 3.6`
- **三线**: `测量数据 × 12 + 测量数据 × 12 × 0.2` = `测量数据 × 14.4`
- **四线**: `测量数据 × 16 + 测量数据 × 16 × 0.2` = `测量数据 × 19.2`
- **五线**: `测量数据 × 19 + 测量数据 × 19 × 0.2` = `测量数据 × 22.8`
- **坎车**: `测量数据 × 20 + 测量数据 × 20 × 0.2` = `测量数据 × 24`
- **三针五线**: `测量数据 × 25 + 测量数据 × 25 × 0.2` = `测量数据 × 30`

**计算说明**: 
- 先计算 `测量数据 × 倍数`
- 再计算 `测量数据 × 倍数 × 0.2`
- 最后相加得到单件用量

#### 3.1.2 显示规则
- 如果某个工艺的测量数据为空，则不显示该工艺的单件用量
- 只显示有测量数据的工艺对应的单件用量

### 3.2 需要线数量

#### 3.2.1 计算公式
```
需要线数量 = 单件用量 ÷ 一轴线长度 × 数量
```

#### 3.2.2 计算范围
- 按工艺和颜色分别计算
- 同一种工艺下，每个颜色单独计算需要线数量
- 同一种工艺下，所有颜色的需要线数量总和 = 该工艺的总需要线数量

#### 3.2.3 精度要求
- **计算精度**: 使用高精度浮点数计算（JavaScript使用Number类型，支持小数点后多位）
- **显示精度**: 保留1位小数
- **存储精度**: 数据库存储时保留足够精度（建议至少4位小数），显示时四舍五入到1位小数

### 3.3 线单价和一轴线长度的匹配规则（已确认）

#### 3.3.1 规则一：只有平车线
当"原料信息"中"线种类"**只有"平车线"数据**时：
- 核算数据数据库表中**所有工艺**的"线单价" = "原料信息"中"平车线"对应的"线单价"
- 核算数据数据库表中**所有工艺**的"一轴线长度" = "原料信息"中"平车线"对应的"一轴线长度"值

#### 3.3.2 规则二：有平车线和丝光线
当"原料信息"中"线种类"**有"平车线"和"丝光线"两个值**时：
- **平车工艺**: 
  - 核算数据数据库表中"工艺"为"平车"的"线单价" = "原料信息"中"平车线"的值
  - 核算数据数据库表中"工艺"为"平车"的"一轴线长度" = "原料信息"中"平车线"对应的"一轴线长度"值
- **其他工艺**（三线、四线、五线、坎车、三针五线）:
  - 核算数据数据库表中"工艺"为"三线"、"四线"、"五线"、"坎车"、"三针五线"的"线单价" = "原料信息"中"丝光线"的值
  - 核算数据数据库表中"工艺"为"三线"、"四线"、"五线"、"坎车"、"三针五线"的"一轴线长度" = "原料信息"中"丝光线"值对应的"一轴线长度"的值

### 3.4 采购金额

#### 3.4.1 计算公式
```
采购金额 = 需要线数量 × 线单价
```

#### 3.4.2 计算范围
- 按工艺和颜色分别计算
- 同一种工艺下，所有颜色的采购金额总和 = 该工艺的总采购金额

### 3.5 线费

#### 3.5.1 计算公式
```
线费 = 采购金额 ÷ 数量
```

#### 3.5.2 计算范围
- 按工艺和颜色分别计算
- **重要规则**: **同一工艺下不同颜色的线费应该相等**（因为单件用量相同，线单价相同，所以线费相同）
- 实际计算中，同一工艺下的所有颜色，线费值应该完全一致

#### 3.5.3 验证规则
- 系统应验证同一工艺下所有颜色的线费是否相等
- 如果不相等，可能存在计算错误

### 3.6 单件线费

#### 3.6.1 计算公式
```
单件线费 = 所有工艺的线费（去重后）的总和
```

#### 3.6.2 计算说明
- **去重规则**: 每个工艺只计算一次线费（因为同一工艺下不同颜色的线费相等）
- **求和规则**: 将所有不同工艺的线费相加，得到单件线费
- 例如：如果订单有平车工艺（线费0.21元）和三线工艺（线费0.23元），则单件线费 = 0.21 + 0.23 = 0.44元

#### 3.6.3 计算示例
- 平车工艺线费: 0.21元（所有颜色的线费都是0.21元）
- 三线工艺线费: 0.23元（所有颜色的线费都是0.23元）
- 单件线费 = 0.21 + 0.23 = 0.44元

### 3.7 数据验证和精度要求

#### 3.7.1 输入数据验证
- **数量验证**:
  - 必须大于0
  - 必须是数字
  - 不能为空
  - 显示错误提示："数量必须大于0"
- **测量数据验证**:
  - 如果输入，必须大于0
  - 必须是数字
  - 允许为空（表示该工艺不参与计算）
  - 显示错误提示："测量数据必须大于0"
- **一轴线长验证**:
  - 必须大于0
  - 必须是数字
  - 不能为空
  - 显示错误提示："一轴线长必须大于0"
- **线单价验证**:
  - 必须大于0
  - 必须是数字
  - 不能为空
  - 显示错误提示："线单价必须大于0"
- **颜色验证**:
  - 订单详情中，颜色不能为空
  - 必须是已存在的颜色（从颜色数据库中选择）
- **服装种类和属性验证**:
  - 服装种类必须选择
  - 属性必须选择
  - 属性必须与所选服装种类匹配

#### 3.7.2 计算精度要求
- **计算精度**: 使用高精度浮点数计算，避免精度丢失
- **单件用量**: 保留4位小数进行中间计算，显示时保留2位小数
- **需要线数量**: 保留4位小数进行中间计算，显示时保留1位小数
- **采购金额**: 保留4位小数进行中间计算，显示时保留2位小数
- **线费**: 保留4位小数进行中间计算，显示时保留2位小数
- **单件线费**: 保留4位小数进行中间计算，显示时保留2位小数
- **采购数量**: 计算后向上取整为整数

#### 3.7.3 数据验证时机
- **实时验证**: 输入框失焦时验证
- **提交验证**: 点击"计算"按钮时验证所有必填项
- **计算前验证**: 确保所有必要数据已填写且有效
- **错误提示**: 使用清晰的错误提示信息，指出具体的错误字段和原因

---

## 4. 采购数量

### 4.1 数据来源
采购数量表格展示核算数据数据库中的内容，按工艺分类展示

### 4.2 显示内容

每个工艺（平车、三线、四线、五线、坎车、三针五线）**独立显示一个表格**，表格包含以下列：

#### 4.2.1 颜色
- **类型**: 公式
- **数据来源**: 订单详情中的颜色
- **显示规则**: 
  - **独立显示每个工艺的每个颜色**
  - 只显示有数据的颜色（有测量数据且订单详情中有该颜色）
  - 每个颜色显示为一行
- **表格列名**: "颜色"

#### 4.2.2 数量
- **类型**: 公式
- **计算公式**: `向上取整(单件用量 ÷ 一轴线长度 × 数量)`（基于"需要线数量"向上取整）
- **计算说明**: 
  - 先计算需要线数量：`单件用量 ÷ 一轴线长度 × 数量`
  - 然后向上取整（因为不能购买0.3轴，必须购买整轴）
  - 例如：计算结果为9.3轴，则采购数量为10轴；计算结果为9.1轴，则采购数量为10轴；计算结果为9.0轴，则采购数量为9轴
- **说明**: 
  - 同一种工艺下同一种颜色的采购数量（单位：轴）
  - **每个颜色独立计算和显示**
  - **必须向上取整**，确保采购数量为整数
- **显示格式**: 整数（不显示小数）

#### 4.2.3 金额
- **类型**: 公式
- **计算公式**: `向上取整后的采购数量 × 线单价`
- **计算说明**: 
  - 使用向上取整后的采购数量（整数）来计算金额
  - 例如：采购数量为10轴，线单价为2.2元/轴，则金额 = 10 × 2.2 = 22.00元
- **说明**: 
  - 同一种工艺下同一种颜色的采购金额（单位：元）
  - **每个颜色独立计算和显示**
  - 基于向上取整后的采购数量计算，确保实际采购金额的准确性
- **显示格式**: 保留2位小数

### 4.3 显示规则
- **按工艺分组显示**: 每个工艺独立显示一个表格
- **显示条件**: 如果某个工艺的测量数据为空，则不显示该工艺的采购数量表格
- **表格结构**: 
  - 表头：工艺名称（如"平车采购数量"）
  - 列：颜色、数量、金额
  - 行：每个颜色一行
  - 可选：合计行（显示该工艺所有颜色的数量总和和金额总和）

### 4.4 表格结构

**表格列定义**:
- **列1 - 颜色**: 订单详情中的颜色名称
- **列2 - 数量（轴）**: 向上取整后的采购数量，整数显示
- **列3 - 金额（元）**: 基于向上取整后的采购数量计算的金额，保留2位小数
- **合计行**: 显示该工艺所有颜色的数量总和和金额总和

### 4.5 表格示例

**平车采购数量**:
| 颜色 | 数量（轴） | 金额（元） |
|------|-----------|-----------|
| 红色 | 10 | 22.00 |
| 蓝色 | 19 | 41.80 |
| 黑色 | 38 | 83.60 |
| 绿色 | 10 | 22.00 |
| **合计** | **77** | **169.40** |

**三线采购数量**:
| 颜色 | 数量（轴） | 金额（元） |
|------|-----------|-----------|
| 红色 | 6 | 24.00 |
| 蓝色 | 12 | 48.00 |
| 黑色 | 23 | 92.00 |
| 绿色 | 6 | 24.00 |
| **合计** | **47** | **188.00** |

---

## 5. 数据模型

### 5.1 服装种类数据库

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| id | 主键 | 唯一标识 | 1 |
| 服装种类 | 字符串 | 服装类型名称 | "冲锋衣" |
| 属性 | 字符串 | 属性名称 | "挂里" |
| 备注 | 字符串 | 备注内容 | "正常拼接挂里" |

**数据示例**:
- 冲锋衣 - 挂里 - 正常拼接挂里
- 冲锋衣 - 不挂里 - 封胶, 包边
- 短裤 - 简单 - 2个口袋, 松紧腰
- 短裤 - 复杂 - 4-6个口袋, 松紧腰

### 5.2 颜色数据库

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 唯一标识 |
| 颜色名称 | 字符串 | 颜色名称，唯一 |
| 创建时间 | 时间戳 | 创建时间 |
| 更新时间 | 时间戳 | 更新时间 |

### 5.3 原料信息数据库

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 唯一标识 |
| 订单ID | 外键 | 关联到订单表 |
| 线种类 | 字符串 | "平车线" 或 "丝光线" |
| 一轴线长 | 数字 | 单位：米 |
| 线单价 | 数字 | 单位：元/轴 |

**说明**: 一个订单可以有多条原料信息记录（多个线种类配置）

### 5.4 订单数据库

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 唯一标识（订单编号） |
| 服装种类 | 字符串 | 服装类型名称 |
| 属性 | 字符串 | 属性名称 |
| 备注 | 字符串 | 备注内容（自动生成） |
| 单件线费 | 数字 | 单位：元（计算得出） |
| 创建时间 | 时间戳 | 订单创建时间 |
| 更新时间 | 时间戳 | 订单最后更新时间 |

### 5.5 订单详情数据库

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 唯一标识 |
| 订单ID | 外键 | 关联到订单表 |
| 颜色 | 字符串 | 颜色名称 |
| 数量 | 数字 | 件数 |

**说明**: 一个订单可以有多条订单详情记录（多个颜色和数量）

### 5.6 测量数据数据库

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 唯一标识 |
| 订单ID | 外键 | 关联到订单表 |
| 工艺 | 字符串 | 工艺名称（平车、三线、四线、五线、坎车、三针五线） |
| 测量数据 | 数字 | 单位：米（可为空） |

**说明**: 一个订单可以有6条测量数据记录（对应6种工艺），测量数据可为空

### 5.7 核算数据数据库

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | 主键 | 唯一标识 |
| 订单ID | 外键 | 关联到订单表 |
| 工艺 | 字符串 | 工艺名称（平车、三线、四线、五线、坎车、三针五线） |
| 颜色 | 字符串 | 颜色名称 |
| 数量 | 数字 | 件数（来自订单详情） |
| 测量数据 | 数字 | 单位：米（可为空） |
| 单件用量 | 数字 | 单位：米（计算得出） |
| 一轴线长度 | 数字 | 单位：米（根据线种类匹配规则确定） |
| 需要线数量 | 数字 | 计算得出（单位：轴，保留1位小数） |
| 线单价 | 数字 | 单位：元/轴（根据线种类匹配规则确定） |
| 采购金额 | 数字 | 单位：元（计算得出，保留2位小数） |
| 线费 | 数字 | 单位：元（计算得出，保留2位小数） |

**说明**: 
- 一个订单可以有多个核算数据记录（按工艺和颜色组合）
- 例如：订单有2种工艺（平车、三线）和4种颜色（红、蓝、黑、绿），则会有8条核算数据记录

---

## 6. 业务流程

### 6.1 创建订单流程
1. 选择服装种类（从服装种类数据库中选择）
2. 根据选择的服装种类，自动匹配可用的属性选项
3. 选择属性（从匹配的属性中选择）
4. 根据选择的属性，自动显示备注（只读）
5. 在主界面直接管理颜色（添加/编辑/删除颜色）
6. 添加订单详情（可选择多个颜色，每个颜色对应一个数量）
7. 配置原料信息（可配置多个线种类，每个线种类包含：线种类名称、一轴线长、线单价）
8. 输入测量数据（各工艺独立输入，至少输入一种工艺的测量数据）
9. 点击"计算"按钮，自动计算所有核算数据
10. 查看计算结果和采购数量表格
11. **保存订单**（系统自动保存订单信息到数据库）

### 6.2 计算流程
1. 根据测量数据计算单件用量
2. 根据线种类匹配规则，确定每个工艺使用的线单价和一轴线长度
3. 根据订单详情，按工艺和颜色计算需要线数量
4. 计算采购金额
5. 计算线费（验证同一工艺下不同颜色的线费是否相等）
6. 计算单件线费（所有工艺线费去重后求和）
7. 生成采购数量表格（按工艺分组，每个颜色独立显示）

### 6.3 显示规则
- 如果某个工艺的测量数据为空，则不显示该工艺相关的所有数据
- 只显示有测量数据的工艺的计算结果和采购数量

### 6.4 订单管理流程

#### 6.4.1 订单保存
- **自动保存**: 每次点击"计算"按钮后，自动保存订单信息
- **保存内容**: 
  - 订单基本信息（服装种类、属性、备注）
  - 订单详情（颜色、数量）
  - 原料信息（线种类配置）
  - 测量数据
  - 计算结果（核算数据）
- **保存时间**: 保存时记录创建时间和最后更新时间

#### 6.4.2 历史订单查询
- **功能**: 支持查看所有历史订单
- **查询方式**:
  - 按订单编号查询
  - 按服装种类筛选
  - 按创建时间范围筛选
  - 按关键字搜索（服装种类、颜色等）
- **显示内容**:
  - 订单列表：订单编号、服装种类、属性、创建时间、最后更新时间
  - 支持排序：按创建时间倒序/正序

#### 6.4.3 订单编辑
- **功能**: 支持编辑已有订单
- **操作流程**:
  1. 从历史订单列表中选择要编辑的订单
  2. 加载订单的所有信息到表单
  3. 修改订单信息（服装种类、属性、订单详情、原料信息、测量数据等）
  4. 重新计算
  5. 保存更新后的订单
- **数据更新**: 保存时更新"最后更新时间"

#### 6.4.4 订单删除
- **功能**: 支持删除订单
- **操作**: 从历史订单列表中删除指定的订单
- **确认机制**: 删除前需要确认，防止误删

#### 6.4.5 数据导出
- **功能**: 支持将订单数据和计算结果导出为Excel文件
- **导出内容**:
  - 订单基本信息（服装种类、属性、备注、创建时间等）
  - 原料信息（线种类配置）
  - 订单详情（颜色、数量）
  - 测量数据
  - 核算数据（按工艺和颜色）
  - 采购数量表格（按工艺分组）
  - 单件线费
- **导出格式**: 
  - Excel格式（.xlsx）
  - 支持多Sheet页：订单信息、核算数据、采购数量
- **导出位置**: 
  - 浏览器下载目录
  - 文件名格式：`订单_{订单编号}_{创建时间}.xlsx`
- **导出按钮位置**: 
  - 订单详情页面：显示"导出Excel"按钮
  - 历史订单列表：支持批量导出选中的订单

---

## 7. 界面设计要求

### 7.1 主界面结构

#### 7.1.1 订单信息区域
- **位置**: 顶部区域
- **包含内容**:
  - 服装种类选择器（下拉选择，支持跳转到管理界面）
  - 属性选择器（自动匹配，只显示与所选服装种类相关的属性）
  - 备注显示框（只读，自动填充）
  - 颜色管理区域（添加/编辑/删除颜色按钮，颜色选择器）

#### 7.1.2 原料信息配置区域
- **位置**: 订单信息区域下方
- **包含内容**:
  - 线种类配置列表（支持添加/删除多个线种类）
  - 每个线种类配置项包含：线种类名称选择/输入、一轴线长输入框、线单价输入框

#### 7.1.3 订单详情区域
- **位置**: 原料信息区域下方
- **包含内容**:
  - 订单详情表格（支持添加/删除行）
  - 每行包含：颜色选择器、数量输入框
  - 支持添加多个颜色和数量组合

#### 7.1.4 测量数据输入区域
- **位置**: 订单详情区域下方
- **包含内容**:
  - 6个独立的测量数据输入框（平车、三线、四线、五线、坎车、三针五线）
  - 每个输入框对应一种工艺，标签清晰

#### 7.1.5 操作按钮区域
- **位置**: 测量数据区域下方
- **包含内容**:
  - "计算"按钮（主要操作按钮，突出显示）
  - "保存订单"按钮（计算后可用）
  - "查看历史订单"按钮
  - "服装种类管理"按钮（跳转到管理界面）
  - "导出Excel"按钮（订单保存后可用）

#### 7.1.6 计算结果展示区域
- **位置**: 操作按钮区域下方
- **包含内容**:
  - 核算数据表格（按工艺和颜色展示）
  - 单件线费显示（突出显示）
  - 采购数量表格（按工艺分组，每个工艺独立表格）

### 7.2 服装种类管理界面

#### 7.2.1 功能按钮区域
- 添加服装种类按钮
- 编辑/删除按钮（在列表中操作）

#### 7.2.2 数据表格区域
- 表格列：服装种类、属性、备注、操作（编辑/删除）
- 支持搜索和筛选
- 支持分页显示

#### 7.2.3 添加/编辑表单
- 服装种类名称输入
- 属性列表（支持添加多个属性）
- 每个属性对应一个备注输入框

### 7.3 历史订单界面

#### 7.3.1 查询筛选区域
- 订单编号搜索框
- 服装种类筛选器
- 创建时间范围选择器
- 关键字搜索框

#### 7.3.2 订单列表区域
- 表格列：订单编号、服装种类、属性、创建时间、更新时间、操作（查看/编辑/删除）
- 支持排序（按创建时间、更新时间）
- 支持分页显示

#### 7.3.3 订单详情查看
- 显示订单的所有信息（订单信息、原料信息、订单详情、测量数据、计算结果）
- 支持编辑和重新计算
- 支持删除订单
- **导出Excel按钮**: 在订单详情页面显示，支持导出该订单的所有数据

---

## 8. 测试用例参考

根据测试数据表，以下是一个完整的测试用例：

### 测试用例1：平车工艺 + 三线工艺

**输入数据**:
- **订单信息**:
  - 服装种类: 冲锋衣
  - 属性: 挂里
  - 备注: 正常拼接挂里（自动生成）
- **订单详情**:
  - 红色: 100件
  - 蓝色: 200件
  - 黑色: 400件
  - 绿色: 100件
- **原料信息**（配置2个线种类）:
  - 线种类1: 平车线 - 一轴线长2700米 - 线单价2.2元/轴
  - 线种类2: 丝光线 - 一轴线长5000米 - 线单价4元/轴
- **测量数据**:
  - 平车: 70米
  - 三线: 20米
  - 四线: 空
  - 五线: 空
  - 坎车: 空
  - 三针五线: 空

**预期计算结果**:

#### 平车工艺:
- **单件用量**: 70 × 3.6 = 252米
- **线单价**: 2.2元/轴（使用平车线的线单价）
- **一轴线长度**: 2700米（使用平车线的一轴线长度）
- **红色**:
  - 需要线数量: 252 ÷ 2700 × 100 = 9.3轴
  - 采购金额: 9.3 × 2.2 = 20.53元
  - 线费: 20.53 ÷ 100 = 0.21元
- **蓝色**:
  - 需要线数量: 252 ÷ 2700 × 200 = 18.7轴
  - 采购金额: 18.7 × 2.2 = 41.07元
  - 线费: 41.07 ÷ 200 = 0.21元（与红色相同）
- **黑色**:
  - 需要线数量: 252 ÷ 2700 × 400 = 37.3轴
  - 采购金额: 37.3 × 2.2 = 82.13元
  - 线费: 82.13 ÷ 400 = 0.21元（与红色相同）
- **绿色**:
  - 需要线数量: 252 ÷ 2700 × 100 = 9.3轴
  - 采购金额: 9.3 × 2.2 = 20.53元
  - 线费: 20.53 ÷ 100 = 0.21元（与红色相同）

#### 三线工艺:
- **单件用量**: 20 × 14.4 = 288米
- **线单价**: 4元/轴（使用丝光线的线单价）
- **一轴线长度**: 5000米（使用丝光线的一轴线长度）
- **红色**:
  - 需要线数量: 288 ÷ 5000 × 100 = 5.8轴
  - 采购金额: 5.8 × 4 = 23.04元
  - 线费: 23.04 ÷ 100 = 0.23元
- **蓝色**:
  - 需要线数量: 288 ÷ 5000 × 200 = 11.5轴
  - 采购金额: 11.5 × 4 = 46.08元
  - 线费: 46.08 ÷ 200 = 0.23元（与红色相同）
- **黑色**:
  - 需要线数量: 288 ÷ 5000 × 400 = 23.0轴
  - 采购金额: 23.0 × 4 = 92.16元
  - 线费: 92.16 ÷ 400 = 0.23元（与红色相同）
- **绿色**:
  - 需要线数量: 288 ÷ 5000 × 100 = 5.8轴
  - 采购金额: 5.8 × 4 = 23.04元
  - 线费: 23.04 ÷ 100 = 0.23元（与红色相同）

#### 单件线费计算:
- 平车工艺线费: 0.21元（所有颜色的线费都是0.21元）
- 三线工艺线费: 0.23元（所有颜色的线费都是0.23元）
- **单件线费**: 0.21 + 0.23 = **0.44元**

#### 采购数量表格显示:

**注意**: 采购数量需要向上取整，因为不能购买0.3轴，必须购买整轴。

**平车采购数量**:
| 颜色 | 需要线数量（计算值） | 采购数量（向上取整） | 金额（元） |
|------|-------------------|-------------------|-----------|
| 红色 | 9.3 | 10 | 22.00 (10 × 2.2) |
| 蓝色 | 18.7 | 19 | 41.80 (19 × 2.2) |
| 黑色 | 37.3 | 38 | 83.60 (38 × 2.2) |
| 绿色 | 9.3 | 10 | 22.00 (10 × 2.2) |
| **合计** | **74.6** | **77** | **169.40** |

**三线采购数量**:
| 颜色 | 需要线数量（计算值） | 采购数量（向上取整） | 金额（元） |
|------|-------------------|-------------------|-----------|
| 红色 | 5.8 | 6 | 24.00 (6 × 4) |
| 蓝色 | 11.5 | 12 | 48.00 (12 × 4) |
| 黑色 | 23.0 | 23 | 92.00 (23 × 4) |
| 绿色 | 5.8 | 6 | 24.00 (6 × 4) |
| **合计** | **46.1** | **47** | **188.00** |

**说明**: 
- "需要线数量"列在实际表格中可以不显示，仅用于说明计算过程
- "采购数量"列显示向上取整后的整数
- "金额"列基于向上取整后的采购数量计算

**验证点**:
1. ✅ 同一工艺下不同颜色的线费应该相等（平车工艺所有颜色线费都是0.21元）
2. ✅ 单件线费 = 所有工艺线费的去重后总和（0.21 + 0.23 = 0.44元）
3. ✅ 采购数量按工艺分组独立显示
4. ✅ 只显示有测量数据的工艺（平车和三线），其他工艺不显示
5. ✅ 采购数量向上取整（9.3轴取整为10轴，18.7轴取整为19轴）
6. ✅ 采购金额基于向上取整后的采购数量计算

---

## 9. 界面图参考说明

### 9.1 界面图理解
根据提供的界面图，系统的界面设计应该遵循以下原则：
- **布局清晰**: 按照订单信息、原料信息、订单详情、测量数据、操作按钮、计算结果的顺序从上到下排列
- **功能分组**: 相关的功能元素分组显示，使用明显的分隔线或背景色区分
- **操作便捷**: 常用操作（如计算、保存）使用醒目的按钮
- **数据展示**: 计算结果使用表格形式清晰展示，重要数据（如单件线费）突出显示

### 9.2 界面图与PRD的一致性
当前PRD文档已经根据界面图的思路和您的回答进行了完善，包括：
- ✅ 订单信息的完整配置流程
- ✅ 原料信息的多个线种类配置
- ✅ 订单详情的多颜色、多数量支持
- ✅ 测量数据的独立输入
- ✅ 核算数据的计算公式和逻辑
- ✅ 采购数量的按工艺分组显示
- ✅ 订单的保存和历史查询功能

### 9.3 已确认的问题

所有问题已确认，以下是确认结果：

#### 9.3.1 关于计算公式 ✅ 已确认
**确认结果**: 计算公式和倍数已确认，与PRD中定义一致：
- 平车: `测量数据 × 3 + 测量数据 × 3 × 0.2` = `测量数据 × 3.6`
- 三线: `测量数据 × 12 + 测量数据 × 12 × 0.2` = `测量数据 × 14.4`
- 四线: `测量数据 × 16 + 测量数据 × 16 × 0.2` = `测量数据 × 19.2`
- 五线: `测量数据 × 19 + 测量数据 × 19 × 0.2` = `测量数据 × 22.8`
- 坎车: `测量数据 × 20 + 测量数据 × 20 × 0.2` = `测量数据 × 24`
- 三针五线: `测量数据 × 25 + 测量数据 × 25 × 0.2` = `测量数据 × 30`

#### 9.3.2 关于线种类匹配规则 ✅ 已确认
**确认结果**: 线种类匹配规则已确认，与PRD中定义一致，已明确两种情况的处理方式。

#### 9.3.3 关于数据导出 ✅ 已确认
**确认结果**: 需要数据导出功能，支持导出为Excel格式，包含订单信息、核算数据、采购数量等所有数据。

#### 9.3.4 关于数据验证 ✅ 已确认
**确认结果**: 需要高精度的数据验证和精度要求，所有数值输入都需要验证：
- 数量必须大于0
- 测量数据必须大于0（如果输入）
- 线单价必须大于0
- 一轴线长必须大于0
- 实时验证和提交验证

#### 9.3.5 关于精度和舍入 ✅ 已确认
**确认结果**: 
- 需要线数量：计算精度保留4位小数，显示时保留1位小数
- 采购金额和线费：计算精度保留4位小数，显示时保留2位小数
- **采购数量的"数量"列需要向上取整**（因为不能买0.3轴，必须购买整轴）

#### 9.3.6 关于用户权限 ✅ 已确认
**确认结果**: 不需要用户登录和权限管理，系统为共享使用，所有数据对所有用户可见和可编辑。

#### 9.3.7 关于技术选型 ✅ 已确认
**确认结果**: Web应用，使用现代Web技术栈开发。

---

## 10. 数据存储方案确认

### 10.1 用户问题
**问题**: 数据库存储是本地存储？还是说可以云端存储，我在任何电脑上都能查询和修改？

### 10.2 推荐方案：云端存储

**建议采用云端存储方案**，原因如下：

#### 10.2.1 优势
1. **跨设备访问**: 在任何电脑上都能查询和修改数据，不限于单台设备
2. **数据安全**: 云端自动备份，降低因电脑故障、重装系统导致的数据丢失风险
3. **数据同步**: 多设备间自动同步，确保数据一致性
4. **协作便利**: 团队成员可以共享数据，提高协作效率
5. **可扩展性**: 便于后续扩展功能（如数据分析、报表等）

#### 10.2.2 实现方案
- **前端**: React/Vue等现代Web框架
- **后端**: Node.js/Python等后端框架，提供RESTful API
- **数据库**: 
  - 关系型数据库（MySQL/PostgreSQL）- 推荐，适合结构化数据
  - 或NoSQL数据库（MongoDB）- 灵活但需要更多设计考虑
- **部署**: 
  - 云服务器（阿里云、腾讯云、AWS等）
  - 或自建服务器
- **数据同步**: 
  - 前端实时同步到云端
  - 支持离线缓存，联网后自动同步

#### 10.2.3 数据存储结构
```
云端服务器
├── 订单数据库
├── 服装种类数据库
├── 颜色数据库
├── 原料信息数据库
├── 核算数据数据库
└── 测量数据数据库
```

#### 10.2.4 可选方案：混合存储
如果需要在某些场景下支持离线使用，可以采用混合存储方案：
- **主存储**: 云端存储
- **本地缓存**: 浏览器IndexedDB缓存最近使用的数据
- **离线模式**: 支持离线查看和编辑，联网后自动同步

### 10.3 成本考虑
- **小型应用**: 可以使用免费的云服务（如Vercel、Netlify的后端函数 + 免费数据库）
- **中型应用**: 需要购买云服务器和数据库服务（月费用约100-500元）
- **大型应用**: 需要更多资源（月费用约500-2000元）

### 10.4 最终建议
**推荐使用云端存储方案**，确保数据可以在任何电脑上查询和修改。如果预算有限，可以先实现云端存储的核心功能，后续根据需求扩展。

---

## 11. PRD版本记录

### 版本 1.0（当前版本）
- ✅ 根据需求表和数据库表创建初始PRD
- ✅ 根据用户回答完善功能需求
- ✅ 添加订单保存和历史查询功能
- ✅ 明确颜色管理和服装种类管理方式
- ✅ 完善计算公式和业务逻辑
- ✅ 添加界面设计要求
- ✅ 添加完整的测试用例

### 待完善项
- 等待用户确认界面图中的细节问题
- 等待用户确认技术选型
- 根据确认结果进一步完善PRD

